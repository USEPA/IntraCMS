!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CKEditor5=e():(t.CKEditor5=t.CKEditor5||{},t.CKEditor5.webAreaLinkit=e())}(self,(function(){return function(){var t={"ckeditor5/src/core.js":function(t,e,i){t.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":function(t,e,i){t.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":function(t,e,i){t.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":function(t){"use strict";t.exports=CKEditor5.dll}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var l=e[n]={exports:{}};return t[n](l,l.exports,i),l.exports}i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};var n={};return function(){"use strict";i.d(n,{default:function(){return d}});var t=i("ckeditor5/src/ui.js"),e=i("ckeditor5/src/core.js"),o=i("ckeditor5/src/utils.js");const l=jQuery;function s(t,e){var i=l("<li>").addClass("linkit-result-line"),n=l("<div>").addClass("linkit-result-line-wrapper");return n.append(l("<span>").html(e.label).addClass("linkit-result-line--title")),e.hasOwnProperty("description")&&n.append(l("<span>").html(e.description).addClass("linkit-result-line--description")),i.append(n).appendTo(t)}function r(t,e){var i=this.element.autocomplete("instance"),n={};e.forEach((function(t){const e=t.hasOwnProperty("group")?t.group:"";n.hasOwnProperty(e)||(n[e]=[]),n[e].push(t)})),l.each(n,(function(e,n){e.length&&t.append('<li class="linkit-result-line--group ui-menu-divider">'+e+"</li>"),l.each(n,(function(e,n){i._renderItemData(t,n)}))}))}class a extends e.Plugin{static get pluginName(){return"WebAreaLinkit"}init(){const t=this.editor;this.locale=t.locale,this.options=t.config.get("linkit"),this.options={...this.options,autocompleteUrl:"/linkit/autocomplete/web_area_content"},this._extendLinkUITemplate(),this._handleExtraFormFieldSubmit(),this._handleDataLoadingIntoExtraFormField()}_extendLinkUITemplate(){const e=this.editor,i=(0,t.createDropdown)(this.locale,t.DropdownButtonView),n=this._buildLinkitProfileList();(0,t.addListToDropdown)(i,n),i.buttonView.set(n.get(1).model),i.extendTemplate({attributes:{class:["ck-epa-web-area-linkit-dropdown"]}});const o=e.plugins.get("LinkUI").formView;let a=!1;e.plugins.get("ContextualBalloon")._rotatorView.content.on("add",((t,e)=>{if(e!==o||a)return;const n=this._createUrlInput();let d;o.children.add(i,0),o.children.add(n,1),o.on("render",(()=>{o._focusables.add(i,1),o.focusTracker.add(i.element),o._focusables.add(n,1),o.focusTracker.add(n.element)})),function(t,e){const{autocompleteUrl:i,selectHandler:n,closeHandler:o,openHandler:a}=e,d={cache:{},ajax:{dataType:"json",jsonp:!1}},u={appendTo:t.closest(".ck-labeled-field-view"),source:function(t,e){const{cache:n}=d;var o=t.term;n.hasOwnProperty(o)?e(n[o]):l.ajax(i,{success:function(t){n[o]=t.suggestions,e(t.suggestions)},data:{q:o},...d.ajax})},select:n,focus:()=>!1,search:()=>!u.isComposing,close:o,open:a,minLength:1,isComposing:!1},c=l(t).autocomplete(u),p=c.data("ui-autocomplete");p.widget().menu("option","items","> :not(.linkit-result-line--group)"),p._renderMenu=r,p._renderItem=s,c.autocomplete("widget").addClass("linkit-ui-autocomplete ck-reset_all-excluded"),c.on("click",(function(){c.autocomplete("search",c.val())})),c.on("compositionstart.autocomplete",(function(){u.isComposing=!0})),c.on("compositionend.autocomplete",(function(){u.isComposing=!1}))}(n.fieldView.element,{...this.options,selectHandler:(t,{item:e})=>{if(!e.path)throw"Missing path param."+JSON.stringify(e);if(e.entity_type_id||e.entity_uuid||e.substitution_id){if(!e.entity_type_id||!e.entity_uuid||!e.substitution_id)throw"Missing path param."+JSON.stringify(e);this.set("entityType",e.entity_type_id),this.set("entityUuid",e.entity_uuid),this.set("entitySubstitution",e.substitution_id)}else this.set("entityType",null),this.set("entityUuid",null),this.set("entitySubstitution",null);return t.target.value=e.path,o.urlInputView.fieldView.element.value=e.path,d=!0,!1},openHandler:t=>{d=!1},closeHandler:t=>{d||(this.set("entityType",null),this.set("entityUuid",null),this.set("entitySubstitution",null)),d=!1}}),a=!0,n.fieldView.template.attributes.class.push("form-linkit-autocomplete"),n.element.style.display="none",this.listenTo(i,"execute",(t=>{!0===t.source.linkitAll?(o.urlInputView.element.style.display="block",n.element.style.display="none"):(o.urlInputView.element.style.display="none",n.element.style.display="block"),i.buttonView.label=t.source.label}))}))}_buildLinkitProfileList(){const e=new o.Collection;return e.add({type:"button",model:new t.Model({withText:!0,label:this.locale.t("Your internal links"),tooltip:this.locale.t("Search within your web areas only."),linkitAll:!1})}),e.add({type:"button",model:new t.Model({withText:!0,label:this.locale.t("No filter: all WebCMS content"),tooltip:this.locale.t("Search within your web areas and www.epa.gov."),linkitAll:!0})}),e}_createButton(e,i,n){const o=e.name,l=this.editor.commands.get("drupalElementStyle"),s=new t.ButtonView(this.locale);return s.set({label:e.title,icon:e.icon,tooltip:!0,isToggleable:!0}),s.bind("isEnabled").to(l,"isEnabled"),s.bind("isOn").to(l,"value",(t=>t&&t[i]===o)),s.on("execute",this._executeCommand.bind(this,o,i)),s}_createUrlInput(){const e=this.locale.t,i=new t.LabeledFieldView(this.locale,t.createLabeledInputText);return i.label=e("Link URL"),i}_handleExtraFormFieldSubmit(){const t=this.editor,e=t.plugins.get("LinkUI").formView,i=t.commands.get("link");this.listenTo(e,"submit",(()=>{const t={"data-entity-type":this.entityType,"data-entity-uuid":this.entityUuid,"data-entity-substitution":this.entitySubstitution};i.once("execute",((e,i)=>{if(i.length<3)i.push(t);else{if(3!==i.length)throw Error("The link command has more than 3 arguments.");Object.assign(i[2],t)}}),{priority:"highest"})}),{priority:"high"})}_handleDataLoadingIntoExtraFormField(){const t=this.editor.commands.get("link");this.bind("entityType").to(t,"data-entity-type"),this.bind("entityUuid").to(t,"data-entity-uuid"),this.bind("entitySubstitution").to(t,"data-entity-substitution")}}var d={WebAreaLinkit:a}}(),n=n.default}()}));